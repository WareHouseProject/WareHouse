<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="utf-8">
	<title>WareHouse MainGame</title>
</head>
<body>

  <script src="enchantjs/enchant.min.js"></script>
  <script src="js/jquery.min.js"></script>
  <script>

    //後でPOSTに変える
    var score = 52;
    var g_Ranking = "";
    var g_RankingText = [];
    var g_index = 0;

    var action = function(){
          //ここにajax処理
        $.ajax({
          type: "POST",
          url: "Ranking.php",
          async: true, 
          data:{ "score":score},
          success: function(j_data){
             g_Ranking = j_data;
            }
        });
    }

    function RankDraw(scene)
    {
        var ranks = g_Ranking.split(",");
        console.log(g_Ranking);
        for (i = 0; i < ranks.length -1 ; i++)
        {
              var txt = (i+1) +"位:"+ranks[i]+"手";
              g_RankingText[i] = new Label(txt);
              g_RankingText[i].font = "42px Palatino";
              //スコアは後で正規の変数に変える
              if(ranks[i] == score) g_RankingText[i].color = '#ff0000';
              else g_RankingText[i].color = '#ffffff';
              g_RankingText[i].moveTo( 580, 100 + (50 * i) );

              window.setTimeout(function() {scene.addChild(
                g_RankingText[g_index]);
                g_index++;
              },2500 + (500 * i));
        }
    }

  $(document).ready(function(){
    action();
  	enchant();							// initialize 
    var game = new Core(960, 768);
    game.preload('Image/Result_BG.png');
    game.fps = 20;
    game.onload = function(){
        
        var scene = new Scene();

        var bg =new Sprite(960,768);
        bg.image = game.assets['Image/Result_BG.png'];
        scene.addChild(bg);

        var text = new Label('ランキング');
        text.font = "42px Palatino";
        text.color = '#ffffff';
        text.moveTo( 380, 40 );
        scene.addChild(text);

        var playerscore = new Label(score+"手");
        playerscore.font = "128px Palatino";
        playerscore.color = '#ff0000';
        playerscore.moveTo( 80, 240 );
        window.setTimeout(function() {scene.addChild(playerscore);},1000);

        var clearscore = new Label('でクリアした');
        clearscore.font = "42px Palatino";
        clearscore.color = '#ffffff';
        clearscore.moveTo( 240, 500 );
        window.setTimeout(function() {scene.addChild(clearscore);},2000);

        RankDraw(scene);

        {
          var text = new Label('EnterキーかSpaceキーでタイトルへ');
          text.font = "42px Palatino";
          text.color = '#ffffff';
          text.moveTo( 140, 650 );
          text.width = 768;
          window.setTimeout(function() {scene.addChild(text);},7500);
        }

        
        game.pushScene(scene);
    }
     game.start();
  });
  </script>
</body>
</html>